version: "3"
services:
  jira:
    image: ${DOCKER_IMAGE}
    container_name: jira
    privileged: true
    environment:
      - TZ=Asia/Seoul
      - JVM_MINIMUM_MEMORY=2048m
      - JVM_MAXIMUM_MEMORY=2048m
      - ATL_JDBC_URL={{ mysql_database }}
      - ATL_DB_DRIVER=com.mysql.jdbc.Driver
      - ATL_JDBC_USER={{ mysql_user }}
      - ATL_JDBC_PASSWORD
      - ATL_TOMCAT_CONTEXTPATH=/jira
    ports:
      - "{{ jira_port }}:8080"
    volumes:
      - {{ jira_data }}:/var/atlassian/application-data/jira
    restart: unless-stopped
{% if use_dkr_net %}
    depends_on:
      - mysql
    networks:
      - {{ dkr_network }}
{% endif %}
  mysql:
    image: mysql
    container_name: mysql
    environment:
      - MYSQL_DATABASE={{ mysql_database }}
      - MYSQL_USER={{ mysql_user }}
      - MYSQL_PASSWORD={{ mysql_password }}
      - MYSQL_ROOT_PASSWORD={{ mysql_password }}
    ports:
      - "{{ mysql_port }}:3306"
    volumes:
      - {{ jira_data }}:/var/lib/mysql
    restart: always
{% if use_dkr_net %}
    networks:
      - {{ dkr_network }}
{% endif %}

{% if use_dkr_net %}
networks:
  {{ dkr_network }}:
    external: true
{% endif %}
