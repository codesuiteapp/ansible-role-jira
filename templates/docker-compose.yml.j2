version: "3"
services:
  jira:
    image: ${DOCKER_IMAGE}
    container_name: jira
    environment:
      - TZ=Asia/Seoul
      - JIRA_DATABASE_URL={{ mysql_database }}
      - JIRA_DB_DRIVER=com.mysql.jdbc.Driver
      - JIRA_DB_PASSWORD={{ mysql_user }}
      - JIRA_DB_PASSWORD={{ mysql_password }}
    ports:
      - "{{ jira_port }}:8080"
    restart: unless-stopped
{% if use_dkr_net %}
    depends_on:
      - mysql
    networks:
      - {{ dkr_network }}
{% endif %}
  mysql:
    image: mysql
    container_name: mysql
    environment:
      - MYSQL_DATABASE={{ mysql_database }}
      - MYSQL_USER={{ mysql_user }}
      - MYSQL_PASSWORD={{ mysql_password }}
      - MYSQL_ROOT_PASSWORD={{ mysql_password }}
    ports:
      - "{{ mysql_port }}:3306"
    volumes:
      - {{ jira_data }}:/var/lib/mysql
    restart: always
{% if use_dkr_net %}
    networks:
      - {{ dkr_network }}
{% endif %}

{% if use_dkr_net %}
networks:
  {{ dkr_network }}:
    external: true
{% endif %}
